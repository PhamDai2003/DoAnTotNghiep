
@{
    ViewData["Title"] = "Home Page";
}

<!-- Header Section End -->
<!-- Hero Section Begin -->
<section class="hero">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <!--categories-->
                <vc:categories></vc:categories>
            </div>
            <div class="col-lg-9">
                @Html.Partial("_SearchPartial")
                <div class="hero__item set-bg" data-setbg="/User/img/banner_handmade.png">
                    <div class="hero__text">
                        <span>HANDMADE</span>
                        <h2>Sản phẩm <br />Thủ công tinh tế</h2>
                        <p>Giao hàng nhanh chóng & tận nơi</p>
                        <a asp-action="Index" asp-controller="Product" class="primary-btn">MUA NGAY</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Hero Section End -->

<!-- Featured Section Begin -->
<section class="featured spad">
    <vc:featured-category-products></vc:featured-category-products>
</section>
<!-- Featured Section End -->
@section Scripts {
    <script>
        // Tạo biến global để script có thể kiểm tra
        const isUserLoggedIn = @(User.Identity.IsAuthenticated ? "true" : "false");
    </script>
    <script>
        const resultsGrid = $('#results-grid');
        // Copy code JavaScript xử lý sự kiện click cho wishlist vào đây
        // Xử lý sự kiện click vào nút yêu thích
            resultsGrid.on('click', '.wishlist-toggle', function (e) {
                e.preventDefault(); // Ngăn hành vi mặc định của thẻ <a>

                // Kiểm tra xem người dùng đã đăng nhập chưa
                if (!isUserLoggedIn) {
                    // Mở popup đăng nhập nếu có, hoặc báo lỗi
                    alert('Vui lòng đăng nhập để sử dụng chức năng này.');
                    return; // Dừng lại
                }

                var button = $(this);
                var productId = button.data('product-id');
                var token = $('input[name="__RequestVerificationToken"]').val();

                $.ajax({
                    url: '/WishlistItem/Toggle', // Gọi đến WishlistController
                    type: 'POST',
                    data: {
                        productId: productId,
                        __RequestVerificationToken: token
                    },
                    success: function (response) {
                        if (response.success) {
                            // Tự động thêm/xóa class "active"
                            button.toggleClass('active', response.added);
                            $('#wishlist-count').text(response.count);
                        } else {
                            alert(response.message || 'Có lỗi xảy ra.');
                        }
                    },
                    error: function () {
                        alert('Đã có lỗi xảy ra khi xử lý yêu thích.');
                    }
                });
            });
    </script>
}
@section Styles {
    <style>
        /* Card sản phẩm */
        .product-card {
            border: none;
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            }

            .product-card img {
                height: 220px;
                object-fit: cover;
            }

            .product-card .card-body {
                padding: 15px;
            }

        .product-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .product-category {
            font-size: 0.9rem;
            color: #6c757d;
        }

        .product-variants {
            font-size: 0.85rem;
            padding-left: 18px;
            color: #495057;
        }

        .product-card {
            position: relative; /* Cần thiết để định vị icon */
        }

        .product-card-hover {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            opacity: 0; /* Ẩn đi mặc định */
            transition: opacity 0.3s ease;
        }

        .product-card:hover .product-card-hover {
            opacity: 1; /* Hiện ra khi di chuột */
        }

        .wishlist-toggle i {
            color: #6c757d;
            font-size: 20px;
            background-color: white;
            padding: 8px;
            border-radius: 50%;
        }

        .wishlist-toggle.active i {
            color: red;
        }
    </style>
}
