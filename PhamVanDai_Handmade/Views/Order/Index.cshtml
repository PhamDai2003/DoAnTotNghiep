@model IEnumerable<PhamVanDai_Handmade.Models.OrderModel>

@{
    ViewData["Title"] = "Quản lý đơn hàng";
}
<section class="hero hero-normal">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <vc:categories></vc:categories>
            </div>
            <div class="col-lg-9">
                @Html.Partial("_SearchPartial")
            </div>
        </div>
    </div>
</section>

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="/User/img/breadcrumb.png">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Lịch sử đơn hàng</h2>
                    <div class="breadcrumb__option">
                        <a asp-action="Index" asp-controller="Home">Trang chủ</a>           
                        <span>Lịch sử đơn hàng</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->
<main id="main" class="main">
    <!-- Danh sách đơn hàng -->
    <section class="section mt-4">
        <div class="container">
            @if (Model.Any())
            {
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Danh sách đơn hàng</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Mã đơn</th>
                                    <th>Người nhận</th>
                                    <th>Số điện thoại</th>
                                    <th>Ngày đặt</th>
                                    <th>Thanh toán</th>
                                    <th>Trạng thái</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var order in Model)
                                {
                                    <tr>
                                        <td>@order.OrderID</td>
                                        <td>@order.DeliveryAddress?.FullName</td>
                                        <td>@order.DeliveryAddress?.PhoneNumber</td>
                                        <td>@order.OrderDate.ToString("dd/MM/yyyy HH:mm")</td>
                                        <td>
                                            <span class="badge @(order.PaymentStatus == 2 ? "bg-success" : order.PaymentStatus == 1 ? "bg-warning" : order.PaymentStatus == 3 ? "bg-success" : "bg-danger")">
                                                @(order.PaymentStatus == 1 ? "Chưa thanh toán" :
                                                        order.PaymentStatus == 2 ? "Đã thanh toán" :
                                                        order.PaymentStatus == 3 ? "Đã hoàn tiền" :
                                                        order.PaymentStatus == 0 ? "Thất bại" : "Chờ xác nhận")
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge
                                        @(order.Status == 0 ? "bg-secondary" :
                                          order.Status == 1 ? "bg-info" :
                                          order.Status == 2 ? "bg-primary" :
                                          order.Status == 3 ? "bg-success" :
                                          order.Status == 4 ? "bg-warning" : "bg-danger")">
                                                @(order.Status == 0 ? "Chờ xử lý" :
                                                        order.Status == 1 ? "Đã xác nhận" :
                                                        order.Status == 2 ? "Đang giao" :
                                                        order.Status == 3 ? "Hoàn thành" :
                                                        order.Status == 4 ? "Hoàn trả" : "Đã hủy")
                                            </span>
                                        </td>
                                        <td>
                                            <a asp-action="Detail" asp-route-id="@order.OrderID" class="btn btn-sm btn-info">
                                                <i class="bi bi-eye"></i> Xem
                                            </a>

                                            @if (order.Status >= 0 && order.Status <= 1)
                                            {
                                                <form asp-action="Cancel" asp-route-id="@order.OrderID" method="post" style="display:inline"
                                                onsubmit="return confirm('Bạn có chắc chắn muốn hủy đơn hàng này?');">
                                                    <button type="submit" class="btn btn-sm btn-danger">
                                                        Hủy
                                                    </button>
                                                </form>
                                            }

                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
            else
            {
                <div class="text-center">
                    <h4>Lịch sử đơn hàng của bạn đang trống!</h4>
                    <p>Hãy khám phá thêm nhiều sản phẩm và mua chúng nhé</p>
                    <a asp-action="Index" asp-controller="Product" class="primary-btn mt-3">Bắt đầu mua sắm</a>
                </div>
            }
            
        </div>
    </section>
</main>
